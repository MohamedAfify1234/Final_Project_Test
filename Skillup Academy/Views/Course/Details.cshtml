@model Course

@{
    ViewData["Title"] = "Course Details: " + Model.Title;
    var baseImageUrl = "/img/";
    var imageUrl = string.IsNullOrEmpty(Model.ThumbnailUrl) ? "/img/default-course.jpg" : baseImageUrl + Model.ThumbnailUrl;
}

<div class="container py-5">
    <div class="row justify-content-center">

        <div class="col-lg-10">

            <h1 class="display-6 mb-2 fw-bold text-dark">@Model.Title</h1>
            <p class="lead text-muted mb-4">@Model.ShortDescription</p>

            @* --- Status and Categorization Panel --- *@
            <div class="d-flex flex-wrap align-items-center mb-5 p-3 rounded-3 bg-white shadow-sm border">

                <span class="badge fs-6 rounded-pill px-3 py-2 @(Model.IsPublished ? "bg-success" : "bg-warning text-dark") me-3">
                    <i class="fas fa-bullhorn me-1"></i> @(Model.IsPublished ? "Published" : "Draft")
                </span>

                <span class="badge fs-6 rounded-pill px-3 py-2 @(Model.IsFree ? "bg-info text-dark" : "bg-dark text-white") me-3">
                    @(Model.IsFree ? "FREE" : "PAID")
                </span>

                @if (Model.Category != null)
                {
                    <span class="text-muted small me-3">
                        <i class="fas fa-tags me-1"></i> Category: @Model.Category.Name
                    </span>
                }
                @if (Model.Teacher != null)
                {
                    <span class="text-muted small">
                        <i class="fas fa-chalkboard-teacher me-1"></i> Instructor: @Model.Teacher.FullName
                    </span>
                }
            </div>

            @* ------------------------------------------------------------------------------------------------------------------- *@
            @* --- 1. Media & Preview Section (Image/Video Display) --- *@
            @* ------------------------------------------------------------------------------------------------------------------- *@
            <div class="row mb-5 g-4">

                @* Thumbnail Display (Image Card) *@
                <div class="col-md-6">
                    <div class="card shadow-lg border-0 h-100 rounded-3 overflow-hidden">
                        <div class="card-header bg-light">
                            <h6 class="mb-0 fw-bold text-primary"><i class="fas fa-image me-2"></i> Course Thumbnail</h6>
                        </div>
                        <div class="card-body p-0">
                            @if (!string.IsNullOrEmpty(Model.ThumbnailUrl))
                            {
                                <img src="@imageUrl" class="img-fluid" alt="@Model.Title" style="width: 100%; height: 300px; object-fit: cover;">
                            }
                            else
                            {
                                <div class="p-5 text-center text-muted" style="height: 300px; display: flex; align-items: center; justify-content: center;">
                                    <div><i class="fas fa-image fs-1 mb-2"></i><p class="mb-0">No Thumbnail Available</p></div>
                                </div>
                            }
                        </div>
                    </div>
                </div>

                @* Video Preview (Video Card) *@
                <div class="col-md-6">
                    <div class="card shadow-lg border-0 h-100 rounded-3 overflow-hidden">
                        <div class="card-header bg-light">
                            <h6 class="mb-0 fw-bold text-primary"><i class="fas fa-video me-2"></i> Preview Video</h6>
                        </div>
                        <div class="card-body p-0">
                            @if (!string.IsNullOrEmpty(Model.PreviewVideoUrl) && (Model.PreviewVideoUrl.EndsWith(".mp4", StringComparison.OrdinalIgnoreCase) || Model.PreviewVideoUrl.Contains("youtube.com")))
                            {
                                @* Assuming we need to handle mp4 or embedded content *@
                                <div class="embed-responsive embed-responsive-16by9" style="height: 300px;">
                                    @if (Model.PreviewVideoUrl.Contains("youtube.com") || Model.PreviewVideoUrl.Contains("youtu.be"))
                                    {
                                        <iframe class="embed-responsive-item" style="width: 100%; height: 100%;"
                                                src="/img/@Model.PreviewVideoUrl" 
                                                allowfullscreen></iframe>
                                    }
                                    else
                                    {
                                        <video controls class="img-fluid" style="width: 100%; height: 100%; background-color: #000;">
                                            <source src="/img/@Model.PreviewVideoUrl" type="video/mp4">
                                            Your browser does not support the video tag.
                                        </video>
                                    }
                                </div>
                            }
                            else
                            {
                                <div class="p-5 text-center text-muted" style="height: 300px; display: flex; align-items: center; justify-content: center;">
                                    <div><i class="fas fa-video-slash fs-1 mb-2"></i><p class="mb-0">No Valid Video Preview Available</p></div>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>

            @* ------------------------------------------------------------------------------------------------------------------- *@
            @* --- 2. Metrics Panel (Prominent Stats) --- *@
            @* ------------------------------------------------------------------------------------------------------------------- *@
            <div class="card shadow-lg mb-5 border-0 rounded-3 overflow-hidden">
                <div class="card-body bg-light">
                    <div class="row text-center">
                        <div class="col-md-3 border-end p-3">
                            <i class="fas fa-users fs-3 text-primary"></i>
                            <h4 class="mt-2 mb-0 fw-bold">@Model.TotalEnrollments</h4>
                            <p class="text-muted small mb-0">Total Enrollments</p>
                        </div>
                        <div class="col-md-3 border-end p-3">
                            <i class="fas fa-star fs-3 text-warning"></i>
                            <h4 class="mt-2 mb-0 fw-bold">@Model.AverageRating.ToString("F1")</h4>
                            <p class="text-muted small mb-0">Average Rating</p>
                        </div>
                        <div class="col-md-3 border-end p-3">
                            <i class="fas fa-book-open fs-3 text-info"></i>
                            <h4 class="mt-2 mb-0 fw-bold">@Model.TotalLessons</h4>
                            <p class="text-muted small mb-0">Total Lessons</p>
                        </div>
                        <div class="col-md-3 p-3">
                            <i class="far fa-clock fs-3 text-secondary"></i>
                            <h4 class="mt-2 mb-0 fw-bold">@Model.TotalDuration Min</h4>
                            <p class="text-muted small mb-0">Total Duration</p>
                        </div>
                    </div>
                </div>
            </div>


            @* ------------------------------------------------------------------------------------------------------------------- *@
            @* --- 3. Full Details (Description, Timestamps) --- *@
            @* ------------------------------------------------------------------------------------------------------------------- *@

            @* Course Description *@
            <div class="card shadow-sm mb-4 border-0">
                <div class="card-header bg-white">
                    <h5 class="mb-0 fw-bold text-dark"><i class="fas fa-file-alt me-2 text-primary"></i> Full Description</h5>
                </div>
                <div class="card-body">
                    <p class="card-text">@Model.Description</p>
                </div>
            </div>

            @* Timestamps & IDs *@
            <div class="card shadow-sm mb-4 border-0">
                <div class="card-header bg-white">
                    <h5 class="mb-0 fw-bold text-dark"><i class="fas fa-history me-2 text-primary"></i> Timestamps & IDs</h5>
                </div>
                <div class="card-body bg-light">
                    <dl class="row mb-0">
                        <dt class="col-sm-3 text-muted">Course ID:</dt>
                        <dd class="col-sm-9">@Model.Id</dd>

                        <dt class="col-sm-3 text-muted">Created Date:</dt>
                        <dd class="col-sm-9">@Model.CreatedDate.ToShortDateString() (@Model.CreatedDate.ToShortTimeString())</dd>

                        <dt class="col-sm-3 text-muted">Last Updated:</dt>
                        <dd class="col-sm-9">@(Model.UpdatedDate?.ToShortDateString() ?? "N/A")</dd>

                        <dt class="col-sm-3 text-muted">Published Date:</dt>
                        <dd class="col-sm-9">@(Model.PublishedDate?.ToShortDateString() ?? "N/A")</dd>
                    </dl>
                </div>
            </div>


            @* --- Action Buttons (Admin Focus) --- *@
            <div class="mt-5 text-center">
                <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-primary btn-lg me-3 px-5 shadow-sm">
                    <i class="fas fa-edit me-2"></i> Edit Course
                </a>
                <a asp-action="Index" class="btn btn-outline-secondary btn-lg px-5">
                    <i class="fas fa-list me-2"></i> Back to List
                </a>
            </div>

        </div>
    </div>
</div>